steps:
# sample image
- name: 'gcr.io/cloud-builders/docker'
  id: 'build-sample-image'
  args: 
  - 'build'
  - '-t'
  - 'us.gcr.io/$PROJECT_ID/sample:latest'
  - '-t'
  - 'us.gcr.io/$PROJECT_ID/sample:$BRANCH_NAME-$REVISION_ID'
  - '--build-arg'
  - 'project_name=sample'
  - '--cache-from'
  - 'us.gcr.io/$PROJECT_ID/sample:latest'
  - 'sample'
# mongodb image
- name: 'gcr.io/cloud-builders/docker'
  id: 'build-mongodb-image'
  args:
  - 'build' 
  - '-t'
  - 'us.gcr.io/$PROJECT_ID/mongodb:latest'
  - '-t'
  - 'us.gcr.io/$PROJECT_ID/mongodb:$BRANCH_NAME-$REVISION_ID'
  - '--cache-from'
  - 'us.gcr.io/$PROJECT_ID/mongodb:latest'
  - 'mongodb'
  waitFor: ['-']
images:
  - 'us.gcr.io/$PROJECT_ID/sample:latest'
  - 'us.gcr.io/$PROJECT_ID/sample:$BRANCH_NAME-$REVISION_ID'
  - 'us.gcr.io/$PROJECT_ID/mongodb:latest'
  - 'us.gcr.io/$PROJECT_ID/mongodb:$BRANCH_NAME-$REVISION_ID'

# todo:
# tag を1つにまとめて実行する